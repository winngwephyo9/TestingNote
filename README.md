<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>メールアドレス検索マニュアル</title>
</head>

<frameset rows="130,*">
<frame src="mokuji.htm" name="mokuji">
<frame src="chuui.htm" name="naiyou">
</frameset><noframes></noframes>

</html>


<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=shift_jis" />
  <title>社内のたくさんの人に一度にまとめてメールを送信したい</title>
<style>
 h3 { color:white;background-color:brown; }
 p.title { font-size:16px;background-color:cccccc;margin-top:37; }
 p.chuui { font-size:16px;background-color:pink; }
 p.copy { margin-top:5;margin-bottom:5;text-align:center;font-size:12px; }
 hr { color:#996600; }
</style>
</head>
<body onLoad="focus()">

<table style="width:625px;">
<tr><td valign="top">

<h3>機能の概要と利用にあたっての注意事項（必ずお読みください）</h3>

<p style="text-align:right;font-weight:bold;color:#ff0000;">関係者外秘 </p>

<p class="title">メールアドレス検索の機能の概要</p>

<ul>
  <li><span style="color:#ff0000;">メールアドレス検索は一斉メール等のために、メールアドレスを検索・抽出するシステムです。</span></li>
  <li>メールアドレス以外にも、個人コード、氏名、店コード、店名、組織コード、組織名、常設・現場、工事区分、在籍区分、職位、役職、従区分コード、従区分名、職種、内線、外線、勤務地を 検索・抽出することができます。</li>
</ul>

<p class="chuui">メールアドレス検索についての注意事項</p>
<ul>
  <li><span style="color:#ff0000;">検索結果のデータのメールアドレスなどは個人情報になります。また一覧データは当社の重要な情報です。取り扱いは十分注意してください。</span>そのため、利用者を制限させていただきます。</li>
  <li>ここで作成した一覧データは、目的を達成し次第削除してください。また他の人にコピーを渡すことは行わないでください。</li>
  <li><span style="color:#ff0000;">この検索はサーバに負荷を与えることから実行可能な時間帯を下記のとおりとしています。<br />
    &nbsp; ８：００～１２：００、 １３：００～２３：３０</span>
  </li>
</ul>

<p class="chuui">一斉メールについての注意事項</p>
<ul>
  <li><span style="color:#ff0000;">一斉メールもサーバに負荷がかかります。送信前に必ず</span>「5. 
    <a href="issei.htm">社内のたくさんの人に一度にまとめてメールを送信したい</a>」<span style="color:#ff0000;">をお読みください。</span></li>
  <li><span style="color:#ff0000;">関係ある人のみに正しい情報が届くように、時間のある時に急がずに行ってください。</span></li>
</ul>

<hr />
<p class="copy">Copyright&copy; 2004-2018 Information Network Department, OBAYASHI Corporation All Rights Reserved.</p>

</td></tr>
</table>

</body>
</html>


![image](https://github.com/user-attachments/assets/1c395b72-a54b-4971-be83-72266bf4f4d0)
^ "Success Page Status Code:"
^ 200
^ "Initial GET to it-nw.isc.obayashi.co.jp status:"
^ 200
^ "Initial GET redirect URL:"
^ ""
array:16 [▼
  0 => array:9 [▼
    "Name" => "amlbcookie"
    "Value" => "01"
    "Domain" => ".obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  1 => array:9 [▼
    "Name" => "JSESSIONID"
    "Value" => "A2E445D1C37945BB8537082E0D66B8FD"
    "Domain" => "login.fc.obayashi.co.jp"
    "Path" => "/sso/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => true
  ]
  2 => array:9 [▼
    "Name" => "iPlanetDirectoryPro"
    "Value" => "AQIC5wM2LY4Sfcx71sLqlFrkVCXqAFfrkBF81WWZy6Ndyro.*AAJTSQACMDMAAlNLABQtODcwOTUwMDUxMTQ2NDcwOTkyMgACUzEAAjAx*"
    "Domain" => ".obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  3 => array:9 [▼
    "Name" => "AMAuthCookie"
    "Value" => "LOGOUT"
    "Domain" => ".obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => 10
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  4 => array:9 [▼
    "Name" => "ID"
    "Value" => "U53439"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  5 => array:9 [▼
    "Name" => "userID"
    "Value" => "53439"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  6 => array:9 [▼
    "Name" => "secCode"
    "Value" => "7"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  7 => array:9 [▼
    "Name" => "staffCode"
    "Value" => "0"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  8 => array:9 [▼
    "Name" => "yakCode"
    "Value" => "999"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  9 => array:9 [▼
    "Name" => "jyuCode"
    "Value" => "50"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  10 => array:9 [▼
    "Name" => "syoCode"
    "Value" => "09332"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  11 => array:9 [▼
    "Name" => "multiCode"
    "Value" => "0130"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  12 => array:9 [▼
    "Name" => "RedirectID"
    "Value" => "11010"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  13 => array:9 [▼
    "Name" => "TAMURL"
    "Value" => "http://www.fc.obayashi.co.jp/"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  14 => array:9 [▼
    "Name" => "X-Oracle-BMC-LBS-Route"
    "Value" => "e6af554aec0684237958a20560a47c61088324f6"
    "Domain" => "lbs3.fc.obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => "10800"
    "Expires" => 1747651404
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  15 => array:9 [▼
    "Name" => "ASPSESSIONIDAABCDAAS"
    "Value" => "JLHIIGPADMGIPPKLMGAIKOIG"
    "Domain" => "lbs3.fc.obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
]
^ "Response after POST to ADDR000.aspx:"
^ """


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>メールアドレス検索</title>
<script type="text/javascript" language="javascript">
//================================================================================================//
function writePOSTData(obj, url) {
    var strFormContents = '<form method="post" id="form1" name="form1" action="' + url + '" target="_self">' + "\n"
    + '<input type="hidden" name="txtConditionFile" value="">' + "\n"
    + '</form>';
    obj.document.write(strFormContents);
}
//================================================================================================//
</script>
</head>

<body>メニュー画面よりアクセスして下さい。</body>

</html>
"""
^ "Frameset not found in the response of the POST request."





dump("Initial GET to it-nw.isc.obayashi.co.jp status:", $initialPickResponse->getStatusCode());
            dump("Initial GET redirect URL:", $initialPickResponse->getHeaderLine('Location'));


            
  ^ "Response after POST to ADDR000.aspx:"
^ """


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>メールアドレス検索</title>
<script type="text/javascript" language="javascript">
//================================================================================================//
function writePOSTData(obj, url) {
    var strFormContents = '<form method="post" id="form1" name="form1" action="' + url + '" target="_self">' + "\n"
    + '<input type="hidden" name="txtConditionFile" value="">' + "\n"
    + '</form>';
    obj.document.write(strFormContents);
}
//================================================================================================//
</script>
</head>

<body>メニュー画面よりアクセスして下さい。</body>

</html>
"""
^ "Frameset not found in the response of the POST request."


// **New Step: Initial GET request to the target domain**
        try {
            $initialPickResponse = $this->client->get("http://it-nw.isc.obayashi.co.jp/pick/manual/addr_man.htm");
            dump("Initial GET to it-nw.isc.obayashi.co.jp status:", $initialPickResponse->getStatusCode());
            $initialPickHtml = (string) $initialPickResponse->getBody();
            // We don't necessarily need to parse this content yet
        } catch (GuzzleException $e) {
            dd("Error during initial GET to it-nw.isc.obayashi.co.jp: " . $e->getMessage());
            return;
        }array:16 [▼




        
  0 => array:9 [▼
    "Name" => "amlbcookie"
    "Value" => "01"
    "Domain" => ".obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  1 => array:9 [▼
    "Name" => "JSESSIONID"
    "Value" => "DB1EE4FFB8D497A01F67C3AE3C067208"
    "Domain" => "login.fc.obayashi.co.jp"
    "Path" => "/sso/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => true
  ]
  2 => array:9 [▼
    "Name" => "iPlanetDirectoryPro"
    "Value" => "AQIC5wM2LY4Sfcy_WrR2g002ZeJs7xhn3-hAV3R-vRiwVCc.*AAJTSQACMDMAAlNLABMxNzQwNjg1Njg0NjQ2MjYwNTgxAAJTMQACMDE.*"
    "Domain" => ".obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  3 => array:9 [▼
    "Name" => "AMAuthCookie"
    "Value" => "LOGOUT"
    "Domain" => ".obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => 10
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  4 => array:9 [▼
    "Name" => "ID"
    "Value" => "U53439"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  5 => array:9 [▼
    "Name" => "userID"
    "Value" => "53439"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  6 => array:9 [▼
    "Name" => "secCode"
    "Value" => "7"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  7 => array:9 [▼
    "Name" => "staffCode"
    "Value" => "0"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  8 => array:9 [▼
    "Name" => "yakCode"
    "Value" => "999"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  9 => array:9 [▼
    "Name" => "jyuCode"
    "Value" => "50"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  10 => array:9 [▶]
  11 => array:9 [▼
    "Name" => "multiCode"
    "Value" => "0130"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  12 => array:9 [▼
    "Name" => "RedirectID"
    "Value" => "11010"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  13 => array:9 [▼
    "Name" => "TAMURL"
    "Value" => "http://www.fc.obayashi.co.jp/"
    "Domain" => "obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  14 => array:9 [▼
    "Name" => "X-Oracle-BMC-LBS-Route"
    "Value" => "e6af554aec0684237958a20560a47c61088324f6"
    "Domain" => "lbs3.fc.obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => "10800"
    "Expires" => 1747650212
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
  15 => array:9 [▼
    "Name" => "ASPSESSIONIDAABCDAAS"
    "Value" => "AOGIIGPAHIKHMGILOGMICNCB"
    "Domain" => "lbs3.fc.obayashi.co.jp"
    "Path" => "/"
    "Max-Age" => null
    "Expires" => null
    "Secure" => false
    "Discard" => false
    "HttpOnly" => false
  ]
]




^ "Response after POST to ADDR000.aspx:"
^ """


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>メールアドレス検索</title>
<script type="text/javascript" language="javascript">
//================================================================================================//
function writePOSTData(obj, url) {
    var strFormContents = '<form method="post" id="form1" name="form1" action="' + url + '" target="_self">' + "\n"
    + '<input type="hidden" name="txtConditionFile" value="">' + "\n"
    + '</form>';
    obj.document.write(strFormContents);
}
//================================================================================================//
</script>
</head>

<body>メニュー画面よりアクセスして下さい。</body>

</html>
"""
^ "Frameset not found in the response of the POST request."


if ($nextPageResponse) {
                    $nextPageHtml = (string) $nextPageResponse->getBody();
                    $nextPageHtml = mb_convert_encoding($nextPageHtml, 'UTF-8', 'shift_jis');
                    dump("Response after POST to ADDR000.aspx:", $nextPageHtml);
                    $nextPageCrawler = new Crawler($nextPageHtml);

                    // Now, look for the frameset in the response of the POST request
                    $framesetNodes = $nextPageCrawler->filter('frameset');

                    if ($framesetNodes->count() > 0) {
                        dd("Found frameset in the response of the POST request:", $nextPageHtml);
                        // Extract frame URLs here as in the previous correct version
                        $frameUrls = [];
                        foreach ($nextPageCrawler->filter('frameset > frame') as $frameElement) {
                            $frameUrls[] = "http://it-nw.isc.obayashi.co.jp/pick/" . $frameElement->getAttribute('src');
                        }

                        // Access and dump content of each frame
                        foreach ($frameUrls as $frameUrl) {
                            try {
                                $frameResponse = $this->client->get($frameUrl);
                                if ($frameResponse->getStatusCode() === 200) {
                                    $frameHtml = (string) $frameResponse->getBody();
                                    $frameHtml = mb_convert_encoding($frameHtml, 'UTF-8', 'shift_jis');
                                    dd("フレーム {$frameUrl} の内容:", $frameHtml);
                                } else {
                                    dd("フレーム {$frameUrl} へのアクセスに失敗:", $frameResponse->getStatusCode(), (string) $frameResponse->getBody());
                                }
                            } catch (\GuzzleHttp\Exception\GuzzleException $e) {
                                dd("フレーム {$frameUrl} へのアクセス中にエラーが発生:", $e->getMessage());
                            }
                        }
                    } else {
                        dd("Frameset not found in the response of the POST request.");
                    }

                    // **Remove the separate GET request to the frameset URL**
                    // $framesetPageUrl = "http://it-nw.isc.obayashi.co.jp/pick/frm/ADDR000.aspx";
                    // $framesetResponse = $this->client->get($framesetPageUrl);
                    // ... (rest of the previous GET request block should be removed)

                } else {
                    dd('Error: Failed to get the page after form submission.');
                }


![image](https://github.com/user-attachments/assets/9716f28c-ba46-45ff-a133-780e5ce52f1c)
![image](https://github.com/user-attachments/assets/a36fbffa-0a56-453c-ac59-ae61854a498d)


use GuzzleHttp\Cookie\CookieJar;
use GuzzleHttp\Uri\UriResolver;
use Psr\Http\Message\RequestInterface;
use Psr\Http\Message\ResponseInterface;
use Symfony\Component\DomCrawler\Crawler;
use GuzzleHttp\Client;
use GuzzleHttp\Exception\GuzzleException;
use GuzzleHttp\Psr7\Uri;

class EmailDataScraperController extends Controller
{
    private $cookieJar;
    private $client;

    public function __construct()
    {
        $this->cookieJar = new CookieJar();
        $this->client = new Client([
            'cookies' => $this->cookieJar, // Use the explicit CookieJar
            'allow_redirects' => true,
            'headers' => [
                'User-Agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36',
                'Accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
                'Accept-Encoding' => 'gzip, deflate',
                'Accept-Language' => 'ja-JP,ja;q=0.9,en-US;q=0.8,en;q=0.7',
                'Cache-Control' => 'no-cache',
                'Connection' => 'keep-alive',
                'Origin' => 'http://login.fc.obayashi.co.jp',
                'Pragma' => 'no-cache',
                'Referer' => 'http://login.fc.obayashi.co.jp/sso/UI/Login?type=obayashi&goto=http%3A%2F%2Fintralogin.fc.obayashi.co.jp%2Fcgi-bin%2Fclogin.cgi%3Faccess%3Dhttp%253A%252F%252Fwww.fc.obayashi.co.jp%252F%252F',
                'Upgrade-Insecure-Requests' => '1',
            ],
        ]);
    }

    public function login()
    {
        $loginUrl = 'http://login.fc.obayashi.co.jp/sso/UI/Login';
        $successRedirectUrl = 'http://www.fc.obayashi.co.jp/';
        $username = 'YOUR_USERNAME'; // Replace with the actual username
        $password = 'YOUR_PASSWORD'; // Replace with the actual password
        $groupCompanyCode = 'U'; // Replace with the desired group company code (e.g., 'U' for 大林組)

        try {
            // 1. Get the initial login page
            $response = $this->client->get($loginUrl);
            $html = (string) $response->getBody();

            // 2. Prepare the login form data
            $loginData = [
                'IDToken0-0' => $groupCompanyCode,
                'IDToken0' => $groupCompanyCode,
                'IDToken1' => $groupCompanyCode . $username,
                'IDToken2' => $password,
                'Login.Submit' => 'ログイン',
                'goto' => 'aHR0cDovL2ludHJhbG9naW4uZmMub2JheWFzaGkuY28uanAvY2dpLWJpbi9jbG9naW4uY2dpP2FjY2Vzcz1odHRwOi8vd3d3LmZjLm9iYXlhc2hpLmNvLmpwLw==',
                'gotoOnFail' => '',
                'SunQueryParamsString' => 'dHlwZT1vYmF5YXNoaQ==',
                'encoded' => 'true',
                'type' => 'obayashi',
                'gx_charset' => 'UTF-8',
                'IDButton' => 'ログイン',
            ];

            // 3. Submit the login form
            $response = $this->client->post($loginUrl, [
                'form_params' => $loginData,
            ]);
            dump("Login Status Code:", $response->getStatusCode());

            if ($response->getStatusCode() >= 200 && $response->getStatusCode() < 300) {
                // Optionally, make a subsequent request to the redirected URL to ensure login success
                $successPageResponse = $this->client->get($successRedirectUrl);
                dump("Success Page Status Code:", $successPageResponse->getStatusCode());
                // You might want to check the content of $successPageResponse here to confirm login

                $this->callFinalUrl();
            } else {
                // Login failed
                $loginHtml = mb_convert_encoding((string) $response->getBody(), 'UTF-8', 'SJIS-win');
                dd('Login failed.', $loginHtml);
            }
        } catch (GuzzleException $e) {
            dd('An error occurred during login: ' . $e->getMessage());
        }
    }

    private function callFinalUrl()
    {
        // 8. メールアドレス検索マニュアルページへのアクセス
        $manualResponse = $this->client->get("http://it-nw.isc.obayashi.co.jp/pick/manual/addr_man.htm");
        $manualHtml = (string) $manualResponse->getBody();
        $manualHtml = mb_convert_encoding($manualHtml, 'UTF-8', 'shift_jis');
        $manualPageCrawler = new Crawler($manualHtml);

        // Extract the URL of the mokuji.htm frame
        $mokujiFrameNode = $manualPageCrawler->filter('frame[name="mokuji"]');
        if ($mokujiFrameNode->count() > 0) {
            $mokujiSrc = $mokujiFrameNode->attr('src');
            $mokujiUrl = "http://it-nw.isc.obayashi.co.jp/pick/manual/" . $mokujiSrc;

            // Access the content of the mokuji.htm page
            $mokujiResponse = $this->client->get($mokujiUrl);
            $mokujiHtml = (string) $mokujiResponse->getBody();
            $mokujiHtml = mb_convert_encoding($mokujiHtml, 'UTF-8', 'shift_jis');
            $mokujiCrawler = new Crawler($mokujiHtml);

            // 9. フォームの送信先 URL と hidden フィールドの値を取得
            $formNode = $mokujiCrawler->filter('form[name="f"]');

            if ($formNode->count() > 0) {
                $formAction = $formNode->attr('action');
                $prevValue = $formNode->filter('input[name="prev"]')->attr('value');

                $relativeUri = new Uri($formAction);
                $baseUri = new Uri("http://it-nw.isc.obayashi.co.jp/pick/manual/");
                $absoluteNextPageUrl = (string) UriResolver::resolve($baseUri, $relativeUri);

                $formData = ['prev' => $prevValue];

                // Make a POST request to ADDR000.aspx
                $nextPageResponse = $this->client->request('POST', $absoluteNextPageUrl, [
                    'form_params' => $formData,
                ]);

                if ($nextPageResponse) {
                    $framesetPageUrl = "http://it-nw.isc.obayashi.co.jp/pick/frm/ADDR000.aspx";
                    $framesetResponse = $this->client->get($framesetPageUrl);

                    if ($framesetResponse->getStatusCode() === 200) {
                        $framesetHtml = (string) $framesetResponse->getBody();
                        $framesetHtml = mb_convert_encoding($framesetHtml, 'UTF-8', 'shift_jis');
                        dd('Frameset Page Content:', $framesetHtml);
                    } else {
                        dd('Failed to access frameset page:', $framesetResponse->getStatusCode(), (string) $framesetResponse->getBody());
                    }

                } else {
                    dd('Error: Failed to get the page after form submission.');
                }
            } else {
                dd('Error: Form with name "f" not found in mokuji.htm.');
            }
        } else {
            dd('Error: Frame with name "mokuji" not found.');
        }
    }
}


![image](https://github.com/user-attachments/assets/40300876-04bc-4fb2-b068-4b2300c32794)

![image](https://github.com/user-attachments/assets/d7def2e4-bfdd-40ab-89e9-3ded980fdac8)

After investigate, I clicked step by step to get this url, return the first folder and html file structure
and I not clicked step by step, I call this url, return the second folder and file


private function callFinalUrl($client)
    {
        // 8. メールアドレス検索マニュアルページへのアクセス
        $manualResponse = $client->get("http://it-nw.isc.obayashi.co.jp/pick/manual/addr_man.htm");
        $manualHtml = (string) $manualResponse->getBody();
        $manualHtml = mb_convert_encoding($manualHtml, 'UTF-8', 'shift_jis');
        $manualPageCrawler = new Crawler($manualHtml);

        // Extract the URL of the mokuji.htm frame
        $mokujiFrameNode = $manualPageCrawler->filter('frame[name="mokuji"]');
        if ($mokujiFrameNode->count() > 0) {
            $mokujiSrc = $mokujiFrameNode->attr('src');
            $mokujiUrl = "http://it-nw.isc.obayashi.co.jp/pick/manual/" . $mokujiSrc;

            // Access the content of the mokuji.htm page
            $mokujiResponse = $client->get($mokujiUrl);
            $mokujiHtml = (string) $mokujiResponse->getBody();
            $mokujiHtml = mb_convert_encoding($mokujiHtml, 'UTF-8', 'shift_jis');
            $mokujiCrawler = new Crawler($mokujiHtml);

            // 9. フォームの送信先 URL と hidden フィールドの値を取得
            $formNode = $mokujiCrawler->filter('form[name="f"]');

            if ($formNode->count() > 0) {
                $formAction = $formNode->attr('action');
                $prevValue = $formNode->filter('input[name="prev"]')->attr('value');

                $relativeUri = new Uri($formAction);
                $baseUri = new Uri("http://it-nw.isc.obayashi.co.jp/pick/manual/");
                $absoluteNextPageUrl = (string) UriResolver::resolve($baseUri, $relativeUri);

                $formData = ['prev' => $prevValue];

                // Make a POST request to ADDR000.aspx
                $nextPageResponse = $client->request('POST', $absoluteNextPageUrl, [
                    'form_params' => $formData,
                ]);

                if ($nextPageResponse) {
                    $nextPageHtml = (string) $nextPageResponse->getBody();
                    $nextPageHtml = mb_convert_encoding($nextPageHtml, 'UTF-8', 'shift_jis');
                    $nextPageCrawler = new Crawler($nextPageHtml);

                    // アクセスを試みるフレームのURLを抽出
                    $framesetPageUrl = "http://it-nw.isc.obayashi.co.jp/pick/frm/ADDR000.aspx";
                    $framesetResponse = $client->get($framesetPageUrl);

                    if ($framesetResponse->getStatusCode() === 200) {
                        $framesetHtml = (string) $framesetResponse->getBody();
                        $framesetHtml = mb_convert_encoding($framesetHtml, 'UTF-8', 'shift_jis');
                        $framesetCrawler = new Crawler($framesetHtml);

                        // フレームセット内のすべてのフレームのsrc属性を抽出
                        $frameUrls = [];
                        foreach ($framesetCrawler->filter('frameset > frame') as $frameElement) {
                            $frameUrls[] = "http://it-nw.isc.obayashi.co.jp/pick/" . $frameElement->getAttribute('src');
                        }

                        // 各フレームにアクセスして内容を表示
                        foreach ($frameUrls as $frameUrl) {
                            try {
                                $frameResponse = $client->get($frameUrl);
                                if ($frameResponse->getStatusCode() === 200) {
                                    $frameHtml = (string) $frameResponse->getBody();
                                    $frameHtml = mb_convert_encoding($frameHtml, 'UTF-8', 'shift_jis');
                                    dd("フレーム {$frameUrl} の内容:", $frameHtml);
                                } else {
                                    dd("フレーム {$frameUrl} へのアクセスに失敗:", $frameResponse->getStatusCode(), (string) $frameResponse->getBody());
                                }
                            } catch (\GuzzleHttp\Exception\GuzzleException $e) {
                                dd("フレーム {$frameUrl} へのアクセス中にエラーが発生:", $e->getMessage());
                            }
                        }
                    } else {
                        dd('フレームセットページへのアクセスに失敗:', $framesetResponse->getStatusCode(), (string) $framesetResponse->getBody());
                    }

                } else {
                    dd('Error: Form with name "f" not found in mokuji.htm.');
                }
            } else {
                dd('Error: Frame with name "mokuji" not found.');
            }
        }
    }
    
    
    An error occurred: Client error: `GET http://it-nw.isc.obayashi.co.jp/pick/ADDR001.aspx` resulted in a `404 Not Found` response:
<html>
    <head>
        <title>リソースが見つかりませんでした。</title>
        <style>
         b (truncated...)
            
            private function callFinalUrl($client)
    {
        // 8. メールアドレス検索マニュアルページへのアクセス
        $manualResponse = $client->get("http://it-nw.isc.obayashi.co.jp/pick/manual/addr_man.htm");
        $manualHtml = (string) $manualResponse->getBody();
        $manualHtml = mb_convert_encoding($manualHtml, 'UTF-8', 'shift_jis');
        $manualPageCrawler = new Crawler($manualHtml);

        // Extract the URL of the mokuji.htm frame
        $mokujiFrameNode = $manualPageCrawler->filter('frame[name="mokuji"]');
        if ($mokujiFrameNode->count() > 0) {
            $mokujiSrc = $mokujiFrameNode->attr('src');
            $mokujiUrl = "http://it-nw.isc.obayashi.co.jp/pick/manual/" . $mokujiSrc;

            // Access the content of the mokuji.htm page
            $mokujiResponse = $client->get($mokujiUrl);
            $mokujiHtml = (string) $mokujiResponse->getBody();
            $mokujiHtml = mb_convert_encoding($mokujiHtml, 'UTF-8', 'shift_jis');
            $mokujiCrawler = new Crawler($mokujiHtml);

            // 9. フォームの送信先 URL と hidden フィールドの値を取得
            $formNode = $mokujiCrawler->filter('form[name="f"]');

            if ($formNode->count() > 0) {
                $formAction = $formNode->attr('action');
                $prevValue = $formNode->filter('input[name="prev"]')->attr('value');

                $relativeUri = new Uri($formAction);
                $baseUri = new Uri("http://it-nw.isc.obayashi.co.jp/pick/manual/");
                $absoluteNextPageUrl = (string) UriResolver::resolve($baseUri, $relativeUri);

                $formData = ['prev' => $prevValue];

                // Make a POST request to ADDR000.aspx
                $nextPageResponse = $client->request('POST', $absoluteNextPageUrl, [
                    'form_params' => $formData,
                ]);

                if ($nextPageResponse) {
                    // Instead of directly accessing the frameset, we need to access the content of the desired frame.
                    $jyokenFrameUrl = "http://it-nw.isc.obayashi.co.jp/pick/ADDR001.aspx"; // URL of the 'jyoken' frame
                    $jyokenResponse = $client->get($jyokenFrameUrl);

                    if ($jyokenResponse->getStatusCode() === 200) {
                        $jyokenHtml = (string) $jyokenResponse->getBody();
                        $jyokenHtml = mb_convert_encoding($jyokenHtml, 'UTF-8', 'shift_jis');
                        dd('メールアドレス検索 Page Content:', $jyokenHtml);
                    } else {
                        dd('Failed to access jyoken frame:', $jyokenResponse->getStatusCode(), (string) $jyokenResponse->getBody());
                    }

                } else {
                    dd('Error: Failed to get the page after form submission.');
                }
            } else {
                dd('Error: Form with name "f" not found in mokuji.htm.');
            }
        } else {
            dd('Error: Frame with name "mokuji" not found.');
        }
    }
    
    
    
    class EmailDataScraperController extends Controller
{
    public function login()
    {
        $client = new Client([
            'cookies' => true, // Enable cookie handling
            'allow_redirects' => true,
            'headers' => [
                'User-Agent' => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36',
                'Accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
                'Accept-Encoding' => 'gzip, deflate',
                'Accept-Language' => 'ja-JP,ja;q=0.9,en-US;q=0.8,en;q=0.7',
                'Cache-Control' => 'no-cache',
                'Connection' => 'keep-alive',
                'Origin' => 'http://login.fc.obayashi.co.jp',
                'Pragma' => 'no-cache',
                'Referer' => 'http://login.fc.obayashi.co.jp/sso/UI/Login?type=obayashi&goto=http%3A%2F%2Fintralogin.fc.obayashi.co.jp%2Fcgi-bin%2Fclogin.cgi%3Faccess%3Dhttp%253A%252F%252Fwww.fc.obayashi.co.jp%252F%252F',
                'Upgrade-Insecure-Requests' => '1',
            ],
        ]);

        $loginUrl = 'http://login.fc.obayashi.co.jp/sso/UI/Login';
        // $successRedirectUrl = 'http://intralogin.fc.obayashi.co.jp/cgi-bin/clogin.cgi?access=http%3A%2F%2Fwww.fc.obayashi.co.jp%2F';
        $successRedirectUrl = 'http://www.fc.obayashi.co.jp/';
        // $username = 'HR75'; // Replace with the actual username
        // $password = 'Win2222'; // Replace with the actual password
        $groupCompanyCode = 'U'; // Replace with the desired group company code (e.g., 'U' for 大林組)

        try {
            // 1. Get the initial login page to potentially retrieve any necessary tokens or cookies
            $response = $client->get($loginUrl);
            $html = (string) $response->getBody();

            // 2. Prepare the login form data
            $loginData = [
                'IDToken0-0' => $groupCompanyCode,
                'IDToken0' => $groupCompanyCode, // Assuming the company code is the same as the group code initially
                'IDToken1' => $groupCompanyCode . $username, // Apply the JavaScript logic
                'IDToken2' => $password,
                'Login.Submit' => 'ログイン',
                'goto' => 'aHR0cDovL2ludHJhbG9naW4uZmMub2JheWFzaGkuY28uanAvY2dpLWJpbi9jbG9naW4uY2dpP2FjY2Vzcz1odHRwOi8vd3d3LmZjLm9iYXlhc2hpLmNvLmpwLw==',
                'gotoOnFail' => '',
                'SunQueryParamsString' => 'dHlwZT1vYmF5YXNoaQ==',
                'encoded' => 'true',
                'type' => 'obayashi',
                'gx_charset' => 'UTF-8',
                'IDButton' => 'ログイン', // Set the IDButton value as per the JavaScript
            ];

            // 3. Submit the login form
            $response = $client->post($loginUrl, [
                'form_params' => $loginData,
            ]);
            dump($response->getStatusCode());
            if ($response->getStatusCode() === 200) {
                // Optionally, you can make a subsequent request to the redirected URL
                $successPageResponse = $client->get($successRedirectUrl);
                $successPageContent = (string)$successPageResponse->getBody();
                $homePageContent = new Crawler($successPageContent);
                $this->callFinalUrl($client);
            } else {
                // Login failed
                $loginHtml = mb_convert_encoding((string) $response->getBody(), 'UTF-8', 'SJIS-win');
                dd('Login failed.', $loginHtml);
            }
            // dd('メールアドレス検索画面 Page Content:', $formHtml);
        } catch (\GuzzleHttp\Exception\GuzzleException $e) {
            dd('An error occurred: ' . $e->getMessage());
        }
    }

    private function callFinalUrl($client)
    {
        // 8. メールアドレス検索マニュアルページへのアクセス
        $manualResponse = $client->get("http://it-nw.isc.obayashi.co.jp/pick/manual/addr_man.htm");
        $manualHtml = (string) $manualResponse->getBody();
        $manualHtml = mb_convert_encoding($manualHtml, 'UTF-8', 'shift_jis');
        $manualPageCrawler = new Crawler($manualHtml);

        // Extract the URL of the mokuji.htm frame
        $mokujiFrameNode = $manualPageCrawler->filter('frame[name="mokuji"]');
        if ($mokujiFrameNode->count() > 0) {
            $mokujiSrc = $mokujiFrameNode->attr('src');
            $mokujiUrl = "http://it-nw.isc.obayashi.co.jp/pick/manual/" . $mokujiSrc;

            // Access the content of the mokuji.htm page
            $mokujiResponse = $client->get($mokujiUrl);
            $mokujiHtml = (string) $mokujiResponse->getBody();
            $mokujiHtml = mb_convert_encoding($mokujiHtml, 'UTF-8', 'shift_jis');
            $mokujiCrawler = new Crawler($mokujiHtml);

            // 9. フォームの送信先 URL と hidden フィールドの値を取得
            $formNode = $mokujiCrawler->filter('form[name="f"]');

            if ($formNode->count() > 0) {
                $formAction = $formNode->attr('action');
                $prevValue = $formNode->filter('input[name="prev"]')->attr('value');

                $relativeUri = new Uri($formAction);
                $baseUri = new Uri("http://it-nw.isc.obayashi.co.jp/pick/manual/");
                $absoluteNextPageUrl = (string) UriResolver::resolve($baseUri, $relativeUri);

                $formData = ['prev' => $prevValue];

                // Make a POST request to ADDR000.aspx
                $nextPageResponse = $client->request('POST', $absoluteNextPageUrl, [
                    'form_params' => $formData,
                ]);

                if ($nextPageResponse) {
                    $nextPageHtml = (string) $nextPageResponse->getBody();
                    $nextPageHtml = mb_convert_encoding($nextPageHtml, 'UTF-8', 'shift_jis');
                    $nextPageCrawler = new Crawler($nextPageHtml);

                    // **Try to find a redirect or a link to the frameset page here**
                    // It's possible the POST request redirects you to the frameset page,
                    // or the $nextPageHtml contains a link to it.

                    // Let's try accessing what might be the initial page containing the frameset
                    $framesetPageUrl = "http://it-nw.isc.obayashi.co.jp/pick/frm/ADDR000.aspx"; // Adjust if you find a different URL
                    $framesetResponse = $client->get($framesetPageUrl);
                    if ($framesetResponse->getStatusCode() === 200) {
                        $framesetHtml = (string) $framesetResponse->getBody();
                        dd('Frameset Page Content:', $framesetHtml);
                        $framesetHtml = mb_convert_encoding($framesetHtml, 'UTF-8', 'shift_jis');
                        dd('Frameset Page Content:', $framesetHtml);
                    } else {
                        dd('Failed to access frameset page:', $framesetResponse->getStatusCode(), (string) $framesetResponse->getBody());
                    }
                } else {
                    dd('Error: Failed to get the page after form submission.');
                }
            } else {
                dd('Error: Form with name "f" not found in mokuji.htm.');
            }
        } else {
            dd('Error: Frame with name "mokuji" not found.');
        }
    }

                        dd('Frameset Page Content:', $framesetHtml);
response is ^ """


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>メールアドレス検索</title>
<script type="text/javascript" language="javascript">
//================================================================================================//
function writePOSTData(obj, url) {
    var strFormContents = '<form method="post" id="form1" name="form1" action="' + url + '" target="_self">' + "\n"
    + '<input type="hidden" name="txtConditionFile" value="">' + "\n"
    + '</form>';
    obj.document.write(strFormContents);
}
//================================================================================================//
</script>
</head>

<body>メニュー画面よりアクセスして下さい。</body>

</html>

but the real respone is  that html source code from console
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>メールアドレス検索</title>
<script type="text/javascript" language="javascript">
//================================================================================================//
function writePOSTData(obj, url) {
    var strFormContents = '<form method="post" id="form1" name="form1" action="' + url + '" target="_self">' + "\n"
    + '<input type="hidden" name="txtConditionFile" value="">' + "\n"
    + '</form>';
    obj.document.write(strFormContents);
}
//================================================================================================//
</script>
</head>

<frameset cols="66%,*">

    <frame id="jyoken" name="jyoken" src="ADDR001.aspx" noresize Scrolling="auto" />
    <frameset rows="33%,*">
        <frame id="koumoku" name="koumoku" src="ADDR002.aspx" noresize Scrolling="auto" />
        <frame id="gamen" name="gamen" src="ADDR003.aspx" noresize Scrolling="auto" />
    </frameset>

</frameset>

</html>

So, What is wrong and how to fix to get the correct html page
